{% macro chart(id, data) %}
<div id="chart{{ id }}" class="chart-container"></div>
<script>
    let chart{{ id }}

    function buildChart{{ id }}(datafile) {
        const options = {{ data | safe }}
        if (typeof options.data !== 'undefined' && Array.isArray(options.data)) options.data = options.data[options.data.length - 1]
        if (options.type != 'dot') {
            options.width = document.getElementById('maincontent').offsetWidth
        }

        chart{{ id }} = new Chart(
            'chart{{ id }}',
            `${location.protocol}//${location.host}${datafile || options.data.data || options.data}`,
            options
        )

        chart{{ id }}.downloadSize().then(data => {
            document.getElementById('chartSize{{ id }}').innerText = ' ' + data
        })
    }

    window.document.addEventListener('DOMContentLoaded', function () {
        buildChart{{ id }}()
    })

    function downloadChart{{ id }}() {
        chart{{ id }}.download()
    }
</script>
{% endmacro %}
