{% macro chart(id, data) %}
{% set data_table = [data, 'data'] | table %}
<div style="width: 100%; height: 100%; margin: 30px 0;">
    <div id="chart{{ id }}" style="width: 100%; height: 100%;"></div>
    <div id="chart{{ id }}_data" style="display none; width: 100%; height: 100%;">
        <table id="table{{ id }}" class="govuk-body-s" style="width: 100%;">
            {% for row in data_table %}
            <tr>
                {% for cell in row %}
                <td>{{ cell }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>
    <a id="chart{{ id }}_download" href="javascript:;" class="govuk-link">Download</a>
    <script>
        window.document.addEventListener('DOMContentLoaded', function () {
            let chart{{ id }} = new Chart(
                'chart{{ id }}',
                `${location.protocol}//${location.host}{{ [data, 'data'] | attribute | safe }}`,
                {{ data | safe }}
            )

            document.getElementById('chart{{ id }}_download').addEventListener('click', function () {
                chart{{ id }}.download()
            })

            //new DataTable('table{{ id }}', null, { 'dataFormat': 'json', 'allowColumnResize': true, 'allowFilter': true, 'allowSort': true, 'allowPagination': false, 'showColumns': false })
        })
    </script>
</div>
{% endmacro %}
