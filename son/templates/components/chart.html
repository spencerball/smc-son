{% macro chart(id, data) %}
<div id="chart{{ id }}" class="chart-container"></div>
{% if ([data, 'type'] | attribute == 'liney' or [data, 'type'] | attribute == 'bar' or [data, 'type'] | attribute == 'bary') and ([data, 'group'] | attribute != '' or [data, 'zkey'] | attribute != '') %}
<p class="govuk-body govuk-!-font-size-14 chart-hint">
    <img src="/static/assets/images/pointer.svg" width="25" height="25">
    Click or tap on legend items to toggle visibility
</p>
{% endif %}
<script>
    let chart{{ id }}

    function buildChart{{ id }}(datafile) {
        const options = {{ data | safe }}
        if (typeof options.data !== 'undefined' && Array.isArray(options.data)) options.data = options.data[options.data.length - 1]
        if (options.type != 'dot') {
            options.width = document.getElementById('maincontent').offsetWidth
        } else {
            options.height = 800
        }

        chart{{ id }} = new Chart(
            'chart{{ id }}',
            `${location.protocol}//${location.host}${datafile || options.data.data || options.data}`,
            options
        )

        if (document.getElementById('chartSize{{ id }}')) {
            chart{{ id }}.downloadSize().then(data => {
                    document.getElementById('chartSize{{ id }}').innerText = ' ' + data
            })
        }
    }

    window.document.addEventListener('DOMContentLoaded', function () {
        buildChart{{ id }}()
    })

    function downloadChart{{ id }}() {
        chart{{ id }}.download()
    }
</script>
{% endmacro %}
