{% macro map(id, data) %}
<div class="map-container">
    <div class="map-controls">
        <button id="mapZoomIn{{ id }}">+</button>
        <button id="mapZoomOut{{ id }}">-</button>
    </div>
    <div id="map{{ id }}" class="map"></div>
    <div id="map_scale{{ id }}" style="width: 50px; height: 300px; position: absolute; top: 20px; left: 20px;"></div>
    <div id="map_tooltip{{ id }}" class="map-tooltip govuk-body">
        <div id="map_legend{{ id }}" class="legend"></div>
        <div class="marker">
            <img id="map_marker{{ id }}" src="/static/assets/images/down_triangle.svg" width="30" height="16">
        </div>
        <div class="scale-qunitile">
            <div class="grid grid5 quintile">
                <div class="q1"></div>
                <div class="q2"></div>
                <div class="q3"></div>
                <div class="q4"></div>
                <div class="q5"></div>
            </div>
            <div class="grid grid2 quintile-legend">
                <div>Q1 - Bottom 20%</div>
                <div>Q5 - Top 20%</div>
            </div>
        </div>
        <div class="scale-viridis">
            <div class="viridis" style="height: 20px; background: #4a7d70; background-image: linear-gradient(90deg, #440154, #482475, #414487, #355f8d, #2a788e, #21908d, #22a884, #42be71, #7ad151, #bddf26, #bddf26);"></div>
            <div class="grid grid2 quintile-legend">
                <div>20</div>
                <div>80</div>
            </div>
        </div>
    </div>
</div>
<script>
    let map{{ id }}
    function buildMap{{ id }}() {
        const options = {{ data | safe }}
        if (typeof options.legend !== 'undefined') options.legend = options.legend + '{{ id }}'

        map{{ id }} = new Choropleth(
            'map{{ id }}',
            `${location.protocol}//${location.host}{{ [data, 'map'] | attribute | safe }}`,
            `${location.protocol}//${location.host}{{ [data, 'data'] | attribute | safe }}`,
            options
        )

        /*document.getElementById('mapZoomIn{{ id }}').addEventListener('click', function () {
            map{{ id }}.zoomIn()
        })

        document.getElementById('mapZoomOut{{ id }}').addEventListener('click', function () {
            map{{ id }}.zoomOut()
        })

        document.getElementById('mapDownload{{ id }}').addEventListener('click', function () {
            map{{ id }}.download()
        })*/
    }
    buildMap{{ id }}()

    function downloadMap{{ id }}() {
        map{{ id }}.download()
    }
</script>
{% endmacro %}
